<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"><title>Admin - Central de Manejo</title>
    <style>
        body { font-family: sans-serif; padding: 40px; background: #f4f7f6; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        th { background: #34495e; color: white; }
        .total-box { background: #8e44ad; color: white; padding: 20px; border-radius: 10px; text-align: center; grid-column: span 2; }
    </style>
</head>
<body>
    <h1>üõ∞Ô∏è Sistema Central de Manejo (Administrador)</h1>
    
    <div class="grid">
        <div class="total-box">
            <h2>Ingresos Brutos Plataforma: $<span id="total-money">0.00</span> USD</h2>
        </div>

        <div class="card">
            <h3>Operadores Activos</h3>
            <table id="op-table">
                <thead><tr><th>Operador</th><th>Ganado</th><th>Acci√≥n</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="card">
            <h3>Monitor de Mensajes (Tiempo Real)</h3>
            <div id="log-msgs" style="height:300px; overflow-y:auto; font-size:12px; border:1px solid #eee; padding:10px;"></div>
        </div>
    </div>

    <script>
        function refresh() {
            const ops = JSON.parse(localStorage.getItem('global_operators') || '[]');
            const msgs = JSON.parse(localStorage.getItem('chat_history') || '[]');
            
            // Tabla Operadores
            document.querySelector('#op-table tbody').innerHTML = ops.map(o => `
                <tr>
                    <td>${o.name}</td>
                    <td>$${o.balance.toFixed(2)}</td>
                    <td><button onclick="borrar('${o.name}')" style="color:red">Eliminar</button></td>
                </tr>
            `).join('');

            // Log de Mensajes
            document.getElementById('log-msgs').innerHTML = msgs.map(m => 
                `<div>[${m.time}] <b>${m.from}</b> -> <b>${m.to}</b>: ${m.text}</div>`
            ).reverse().join('');

            // Calculo Total (Simulaci√≥n: la plataforma cobra el doble de lo que paga)
            let total = ops.reduce((acc, current) => acc + current.balance, 0) * 2;
            document.getElementById('total-money').innerText = total.toFixed(2);
        }

        function borrar(name) {
            let ops = JSON.parse(localStorage.getItem('global_operators') || '[]');
            ops = ops.filter(o => o.name !== name);
            localStorage.setItem('global_operators', JSON.stringify(ops));
            refresh();
        }

        window.addEventListener('storage', refresh);
        setInterval(refresh, 2000); // Auto-refresco cada 2 segundos
        refresh();
    </script>
</body>
</html>